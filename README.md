# Market-Risk & Derivatives Lab

This repository is an educational, research-style toolkit for pricing and hedging European options under multiple models and numerical methods. It is designed to emphasize correctness, validation, and model-risk awareness rather than trading performance or investment advice.

## What This Repo Contains

- `src/`: modular pricing, hedging, simulation, PDE, FX, and overlay components.
- `notebooks/`: ten end-to-end notebooks from environment setup to ASML real-data capstone.
- `tests/`: pytest validation suite with cross-method sanity checks.
- `results/`: saved tables/figures/logs generated by notebooks.
- `data/`: optional raw/processed data cache for historical context (synthetic mode is default).
- `sources/`: extensive external references (papers, docs, tutorials, forums, videos) in `sources/SOURCES.md`.

### Module Map (`src/`)

- `config.py`: global defaults and fast/full mode conversion.
- `utils.py`: seeding, directory setup, helper assertions/conversions.
- `black_scholes.py`: closed-form BS prices and Greeks.
- `implied_vol.py`: robust implied-vol inversion.
- `binomial.py`: CRR tree pricing and replication diagnostics.
- `processes.py`: Brownian increments and GBM simulations.
- `monte_carlo.py`: MC pricing with CI and variance-reduction utilities.
- `sde.py`: Euler discretization helper experiments.
- `pde_fd.py`: finite-difference (Crank-Nicolson / implicit) BS PDE pricer.
- `hedging.py`: discrete delta-hedging simulations with transaction costs.
- `stoch_vol.py`: Heston-lite simulation for model-risk smile experiments.
- `fx_options.py`: Garman-Kohlhagen FX option pricing and IV inversion.
- `portfolio_overlay.py`: protective-put overlay capstone simulation.
- `metrics.py`: CVaR, drawdown, annualized vol, summary metrics.
- `plotting.py`: matplotlib output helpers.
- `interactive.py`: lightweight `ipywidgets` notebook controls.
- `market_data.py`: optional yfinance data fetch utilities.

## Local Setup

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -e .[dev]
# optional
pip install -e .[data]
```

Run tests:

```bash
pytest
```

Run notebooks:

```bash
jupyter lab
```

## Colab Setup

In `notebooks/00_environment_and_conventions.ipynb`:

```python
!pip install -q numpy pandas scipy matplotlib ipywidgets pytest
# optional
!pip install -q yfinance

from google.colab import output
output.enable_custom_widget_manager()
```

If widgets do not render, restart the runtime and rerun the widget manager cell.

## ASML Capstone

The final notebook `notebooks/09_asml_real_data_capstone.ipynb` runs a full real-data workflow on `ASML` since `2020-01-01`, including:

- Data integrity checks and gap diagnostics.
- Pricing cross-check (BS, Binomial, MC, PDE).
- Implied volatility from option snapshot data (with fallback handling).
- Historical-window hedging plus stochastic-vol model-risk stress.
- Protective-put overlay on historical windows.
- Auto-generated report in `results/reports/09_asml_capstone_summary.md`.

## Validation Philosophy

The project cross-checks methods against each other instead of trusting one implementation:

- CRR binomial prices converge to Black-Scholes.
- Monte Carlo prices are checked against Black-Scholes confidence intervals.
- Finite-difference PDE prices are compared against Black-Scholes with grid convergence.
- Implied-vol inversion is validated on synthetic prices with known volatility.
- Delta-hedging experiments test rebalancing-frequency and transaction-cost tradeoffs.
- FX put-call parity is verified in Garman-Kohlhagen form.

## Limitations

- European options only in core modules.
- No American option pricing or early exercise logic.
- No full stochastic-vol calibration to market data.
- Stochastic volatility component is a model-risk demonstration, not production calibration.

## Future Extensions

- American options via Longstaff-Schwartz Monte Carlo.
- Heston calibration to market implied-vol surfaces.
- Barrier and path-dependent option modules.
- Local volatility and jump-diffusion model comparisons.
